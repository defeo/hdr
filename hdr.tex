\documentclass{report}

\usepackage[b5paper]{geometry}
\usepackage[english]{babel}
\usepackage{array}
\usepackage{amsmath,amsthm,amsfonts,amssymb}
\usepackage{unicode}
\usepackage[type={CC},modifier={by-nc-sa},imagemodifier={-eu},version={4.0},imagewidth=5em]{doclicense}
\usepackage{fancyhdr}

\usepackage{algorithmic}
\renewcommand{\algorithmicrequire}{\textbf{Input:}}
\renewcommand{\algorithmicensure}{\textbf{Output:}}
\algsetup{linenodelimiter=.}

\usepackage[pdfusetitle]{hyperref}
\hypersetup{
  unicode=true,
  colorlinks=true,
  citecolor=blue!70!black,
  filecolor=black,
  linkcolor=red!70!black,
  urlcolor=blue,
  pdfstartview={FitH},
  pdfauthor={Luca De Feo},
  pdfsubject={Mathematics},
  pdfkeywords={Cryptography, Number theory, Computer algebra, Elliptic curves, Isogenies, Finite fields},
}

\usepackage{tikz}
\usetikzlibrary{arrows,trees,matrix,decorations,decorations.text,decorations.pathmorphing,calc}
\pgfkeys{/triangle/.code=\tikzset{x={(-0.5cm,-0.866cm)},y={(1cm,0cm)}}}
\pgfkeys{/lattice/.code n args={4}{\tikzset{cm={#1,#2,#3,#4,(0,0)}}}}

% theorem environments
\theoremstyle{plain}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{proposition}[theorem]{Proposition}
\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{example}[theorem]{Example}
\newtheorem{problem}{Problem}

\include{preamble}

\title{Promenades in isogeny graphs}
%\subtitle{Habilitation à diriger des recherches}
\author{Luca De Feo}

\begin{document}

\maketitle
\thispagestyle{fancy}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0.4pt}
\cfoot{\doclicenseThis}
\lfoot{\LaTeX{} source code available at \url{https://github.com/defeo/hdr/}.}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Intro, etc.}

We'll take a journey, from one lonely elliptic curve over a finite
field to the amazingly rich world of isogeny graphs.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Finite fields and elliptic curves}

As short as possible, maybe write after, maybe an appendix.

- projective space, projective varieties,
- elliptic curves, torsion
- ordinary, supersingular (how many?)
- endomorphism ring
- function fields, algebraic maps, frobenius, degree
- differentials? pullbacks?
- modular polynomial?

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{The neighborhood}

% \begin{verse}
% You climb out the chimney\\
% And meet me in the middle\\
% The middle of the town\\
% And since there's no one else around,\\
% We let our hair grow long and forget all we used to know\\
% Then our skin gets thicker from living out in the snow
%
% Arcade Fire, The neighborhood #1 (Tunnels)
% \end{verse}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Isogenies}

An isogeny is a non-constant algebraic map between elliptic curves,
preserving the point at infinity. %
An isogeny is also a surjective group morphism of elliptic curves. %
It turns out these definitions are equivalent, but, before getting
these pages drenched in more properties and theorems, let's have a
look at an example.

The map $ϕ$ from the elliptic curve $y^2=x^3+x$ to $y^2=x^3-4x$
defined by
\begin{equation}
  \label{eq:isog-example}
  \begin{aligned}
    ϕ(x,y) &= \left(\frac{x^2+1}{x},y\frac{x^2-1}{x^2}\right),\\
    ϕ(\O) &= \O
  \end{aligned}
\end{equation}
is an isogeny. %
As an algebraic map it has degree $2$, which implies that it is a
two-to-one map, as it can be inferred from the polynomial degrees. %
Our rational maps are not defined at $x=0$, but the first expression
should really be understood as the projective map
\begin{equation*}
  ϕ(X:Y:Z) = \bigl(X(X^2+Z^2):Y(X^2-Z^2):ZX^2\bigr),
\end{equation*}
showing that the only other point in $\ker ϕ$, besides $\O$, is
$(0:0:1)$.


\begin{figure}
  \centering
  \begin{tikzpicture}[x=0.03\textwidth,y=0.03\textwidth]
    \begin{scope}
      \node[anchor=center] at (0,7) {$E \;:\; y^2 = x^3 + x$};

      \draw[thin,gray] (0,-6) -- (0,6);
      \draw[thin,gray] (-6,0) -- (6,0);

      \foreach \x/\y in {0/0,5/3,-4/3,-3/5,-2/1,-1/3} {
        \draw[blue,fill] (\x,\y) circle (0.2) node(E_\x_\y){}
        (\x,-\y) circle (0.2) node(E_\x_-\y){};
      }
    \end{scope}

    \draw[black!10!white,thick] (8,-7) -- +(0,14);
    
    \begin{scope}[shift={(16,0)}]
      \node at (0,7) {$E' \;:\; y^2 = x^3 - 4x$};

      \draw[thin,gray] (0,-6) -- (0,6);
      \draw[thin,gray] (-6,0) -- (6,0);

      \foreach \x/\y in {0/0,2/0,3/2,4/2,6/4,-2/0,-1/5} {
        \draw[color=blue,fill] (\x,\y) circle (0.2) node(F_\x_\y){}
        (\x,-\y) circle (0.2) node(F_\x_-\y){};
      }
    \end{scope}

    \begin{scope}[color=red,-latex,dashed]
        \path
        (E_5_3) edge (F_3_2)
        (E_-4_3) edge (F_4_-2)
        (E_-3_5) edge (F_4_2)
        (E_-2_1) edge (F_3_-2)
        (E_-1_3) edge (F_-2_0);
        \path
        (E_5_-3) edge (F_3_-2)
        (E_-4_-3) edge (F_4_2)
        (E_-3_-5) edge (F_4_-2)
        (E_-2_-1) edge (F_3_2)
        (E_-1_-3) edge (F_-2_0);
    \end{scope}
  \end{tikzpicture}
  \caption{The isogeny $(x,y) \mapsto \bigl((x^2+1)/x,\;y(x^2-1)/x^2\bigr)$,
    as a map between curves defined over $\F_{11}$.}
  \label{fig:isog-example}
\end{figure}


What does an isogeny ``look like''? %
Drawing the above one in $\R^2$ would look rather messy, but an
isogeny defined over the rationals is still an isogeny if we reduce
modulo a prime $p$. %
Figure~\ref{fig:isog-example} plots the action of the
isogeny~\eqref{eq:isog-example} on the image of the curves in
$\F_{11}$. %
A red arrow indicates that a point of the left curve is sent onto a
point on the right curve; the action on the point in $(0,0)$, going to
the point at infinity, is not shown. %
We observe a symmetry with respect to the $x$-axis, a consequence of
the fact that $ϕ$ is a group morphism; and, by looking closer, we may
also notice that collinear points are sent to collinear points, also a
necessity for a group morphism. %

Something strikes us, though: the map looks by no means surjective! %
This is because, when we think of isogenies, we think of them as
geometric objects, acting on the extension of the curves to the
algebraic closure. %
This is not dissimilar from the way power-by-$n$ maps act on the
multiplicative group $k^\times$ of a field $k$: the map $x↦x^2$, for
example, is a two-to-one (algebraic) group morphism on
$\F_{11}^\times$, and those elements that have no preimage, the
non-squares, will have exactly two square roots in $\F_{11^2}$, and so
on. %
In much the same way, in an algebraic closure $\bar{\F}_{11}$ of
$\F_{11}$, the isogeny $ϕ$ becomes surjective and every point gains
exactly two antecedents. %
This analogy is more profound that it may seem, and shall bear its
fruits in Chapter~\ref{cha:fpbar}.

For elliptic curves defined over a field of characteristic $p>0$,
there is another kind of isogeny. %
Let $E:y^2=x^3+ax+b$ be an elliptic curve, let $q$ be a power of $p$, and let
$E^{(q)}:y^2=x^3+a^qpx+b^q$. %
The isogeny $π_q:E→ E^{(q)}$ defined by
\begin{equation}
  \begin{aligned}
    π_q(x,y) &= (x^q,y^q),\\
    π_q(\O) &= \O
  \end{aligned}
\end{equation}
is a \emph{purely inseparable} isogeny of degree $q$. %
We call $π_q$ a \emph{Frobenius isogeny}. %
Despite being of degree $q$, Frobenius isogenies have trivial kernel,
and are one-to-one over finite fields (and other perfect fields). %

% Plotting the action of $π_p$ on the curve of
% Figure~\ref{fig:isog-example} would not be very telling, since in this
% case $E^{(p)}=E$ and the map acts like the identity on $\F_{11}$. %
% However $π_p$ is an important map, called the \emph{Frobenius
%   endomorphism} of $E$, and often denoted simply by $π$. %
% It permutes the points of $E/\bar{\F}_{11}$ in a non trivial way,
% reflecting the action of the Galois group of $\bar{\F}_{11}/\F_{11}$
% on $E$. %

Any isogeny can be decomposed as a product of a Frobenius isogeny and
a \emph{separable} isogeny:
\begin{equation*}
  \begin{tikzpicture}
    \node(E) at (0,0) {$E$};
    \node(Ep) at (2,0) {$E^{(q)}$};
    \node(E') at (4,0) {$E'$};
    \draw[->,auto] (E) edge node{\small $π_q$} (Ep)
    (Ep) edge node{\small $ϕ_s$} (E')
    (E) edge[bend right=20] node[below]{\small $ϕ$} (E');
  \end{tikzpicture}
\end{equation*}
Computing this decomposition is also easy given rational functions for
$ϕ$: simply factor out the powers of $p$ from the polynomials. %
For these reasons we shall be mostly concerned with separable
isogenies and their computations.

The most unique property of separable isogenies is that they are 
entirely determined by their kernel. %

\begin{proposition}
  Let $E$ be an elliptic curve, and let $G$ be a finite subgroup of
  $E$. %
  There is a curve $E'$, and a separable isogeny $ϕ$, such that
  $\ker ϕ=G$ and $ϕ:E→ E'$. %
  Furthermore, $E'$ and $ϕ$ are unique up to composition with an
  isomorphism $E'≃E''$. %
\end{proposition}

Said otherwise, for any finite subgroup $G⊂E$, we have an exact
sequence of algebraic groups
\begin{equation*}
  0 → G → E \overset{ϕ}{→} E' → 0.
\end{equation*}
Uniqueness up to isomorphisms justifies the notation $E/G$ for the
isomorphism class of the image curve $E'$. %
Now, it would be useful if we could find a way to define a canonical
representative inside $E/G$. %
It turns out there is a pretty natural way to define one.

\begin{definition}[Normalized isogeny]
  Let $E,E'$ be two elliptic curves, $ω_E,ω_E'$ their \emph{invariant
    differential}, $ϕ:E→ E'$ a separable isogeny and
  $ϕ^*:Ω_{E'}→ Ω_E$ its \emph{pullback}. %
  We say that $ϕ$ is \emph{normalized} if its pullback preserves the
  invariant differentials, i.e., $ϕ^*(ω_{E'})=ω_E$. %
\end{definition}

Since $ϕ$ is separable, $ϕ^*$ is an isomorphism of vector spaces of
dimension one. %
I.e., if $ϕ$ is not normalized, then it is only ``off'' by a
(non-zero) constant $ϕ^*(ω_{E'})=cω_E$, and we can easily normalize
$ϕ$ by a change of variables. %
This also shows that, for fixed $E$ and $\ker ϕ$, the normalized
isogeny is unique, and justifies abusing the notation $E/G$ to mean
the image of the normalized isogeny with kernel $G$.\footnote{Note
  that this convention is not universal in the literature, as there
  are other useful choices for a canonical representative of $E/G$.}

Conversely, since any non-constant morphism of algebraic curves
necessarily has finite kernel, we have a canonical bijection between
the finite subgroups of a curve $E$ and the normalized isogenies with
domain $E$. %
This correspondence is rich in consequences: it is an easy exercise to
prove the following useful facts. %

\begin{corollary}\ 
  \begin{enumerate}
  \item Any isogeny can be decomposed as a product of prime degree
    isogenies.
  \item Let $E$ be defined over an algebraically closed field $k$, let
    $ℓ$ be a prime different from the characteristic of $k$, then
    there are exactly $ℓ+1$ normalized isogenies of degree $ℓ$ with
    domain $E$.
  \end{enumerate}
\end{corollary}

Slightly less more work is required to prove the following,
fundamental, theorem (the difficulty comes essentially from the
inseparable part, see~\cite[III.6.1]{silverman:elliptic} for a
detailed proof).

\begin{theorem}[Dual isogeny theorem]
  Let $ϕ:E→ E'$ be an isogeny of degree $m$. %
  There is a unique isogeny $\hat{ϕ}:E'→ E$ such that
  \[\hat{ϕ}∘ϕ = [m]_E, \quad ϕ∘\hat{ϕ} = [m]_{E'}.\] %
  $\hat{ϕ}$ is called the \emph{dual isogeny of $ϕ$}; it has the
  following properties:
  
  \begin{enumerate}
  \item $\hat{ϕ}$ has degree $m$;
  \item $\hat{ϕ}$ is defined over $k$ if and only if $ϕ$ is;
  \item $\widehat{ψ∘ϕ} = \hat{ϕ}∘\hat{ψ}$ for any isogeny $ψ:E'→ E''$;
  \item $\widehat{ψ+ϕ} = \hat{ψ} + \hat{ϕ}$ for any isogeny $ψ:E→ E'$;
  \item $\deg ϕ = \deg\hat{ϕ}$;
  \item $\hat{\hat{ϕ}} = ϕ$.
  \end{enumerate}
\end{theorem}

Note that, since $[m]^*(ω)=mω$, if $ϕ$ is normalized $\hat{ϕ}$ almost
never is. %
The computational counterpart to the kernel-isogeny correspondence, is
given by Vélu's much celebrated formulas. %

\begin{proposition}[{Vélu~\cite{velu71}}]
  \label{th:velu}
  Let $E:y^2=x^3+ax+b$ be an elliptic curve defined over a field $k$,
  and let $G⊂E(\bar{k})$ be a finite subgroup. %
  The normalized separable isogeny $ϕ:E→ E/G$, of kernel $G$, can be
  written as
  \begin{equation*}
    ϕ(P) = \left(
      x(P) + \sum_{Q∈G\setminus\{\O\}}x(P+Q)-x(Q),\\
      y(P) + \sum_{Q∈G\setminus\{\O\}}y(P+Q)-y(Q)
    \right);
  \end{equation*} %
  and the curve $E/G$ has equation $y^2=x^3+a'x+b'$, where
  \begin{align*}
    a' &= a - 5\sum_{Q∈G\setminus\{\O\}}(3x(Q)^2+a),\\
    b' &= b - 7\sum_{Q∈G\setminus\{\O\}}(5x(Q)^3+3ax(Q)+b).
  \end{align*}
\end{proposition}

But how ``good'' are Vélu's formulas from a computational
perspective? %
``Pretty good'', is the message we want to convey, but, in order to
understand the question, we need to discuss \emph{rationality}. %
Let $E$ be defined over a field $k$ with algebraic closure
$\bar{k}$. %
We say that an isogeny $ϕ:E→ E'$ is \emph{defined over $k$}, or
\emph{$k$-rational}, if $ϕ$ is invariant under the action of the
Galois group of $\bar{k}/k$. %
This is equivalent to $ϕ$ being defined by rational maps with
coefficients in $k$, and implies\footnote{The converse is only true up
  to \emph{twist}} that $\ker ϕ$ is stable under $\Gal(\bar{k}/k)$. %
It implies that $E'$ is defined over $k$, but the converse is not
true. %

In the rest of this work, when we say ``an isogeny'', we really mean
``an isogeny defined over the base field'', unless specified
otherwise. %
What are the input and output sizes of Vélu's formulas, if we
restrict to $k$-rational isogenies? %

The output is a pair of rational fractions, and, letting $ℓ=\#G$, it
is not too difficult to see that they have $O(ℓ)$ coefficients. %
The input is the kernel $G$, and, since it is finite, it must be
generated by at most two elements. %
However $G$ is only stable under $\Gal(\bar{k}/k)$, implying that its
elements are defined in an (Abelian) extension of degree dividing
$ℓ$. %
Thus, in general, $G$ is represented by $\O(\ell)$ coefficients of $k$. %

Now, if we apply mindlessly Vélu's formulas, we need at list $O(ℓ^2)$
coefficients in $k$ to write down all the elements of $G$. %
A better approach is to represent $G$ by a polynomial with
coefficients in $k$ that vanishes on all $P∈G$, for example
\begin{equation*}
  h_G(x) = \prod_{P∈G\setminus\{\O\}} (x - x(P)).
\end{equation*}
The polynomial $h_G$ is called the \emph{kernel
  polynomial}\footnote{Other works prefer defining the kernel
  polynomial as the square root of $h_G$, however this adds some
  complications when $\#G$ is even.} of $G$, and has coefficients in
$k$ if and only if $ϕ$ is $k$-rational; it can be computed from the
generators of $G$ in only $\tildO(ℓ)$ operations over $k$. %
Following Kohel~\cite{kohel}, we can rewrite Vélu's formulas in terms
of $h_G$, then, their evaluation can also be accomplished in
$\tildO(ℓ)$ operations.

In conclusion, we see that Vélu's formulas make the kernel/isogeny
correspondence explicit, using a quasi-optimal number of operations in
general. %
This will be crucial when we will study isogeny-based cryptosystems in
Chapter~\ref{cha:crypto}, however, we will encounter there some
examples where the cost of evaluating an isogeny is exponentially
lower than that of Vélu's formulas. %


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{The explicit isogeny and other problems}

When it comes to computations, Vélu's formulas are only part of the
story: how do we find a rational kernel $G$ in the first place?
Elkies, while working on point counting~\cite{elkies92,elkies98},
famously baptized this the \emph{explicit isogeny problem}.

\begin{problem}[Explicit isogeny problem]
  \label{prob:expl-isog}
  Let $E$ be an elliptic curve, and let $ℓ$ be an integer. %
  Find, if it exists, an isogeny of degree $ℓ$ with domain $E$.
\end{problem}

A slightly modified version of the same problem is often found in the
literature.

\begin{problem}
  \label{prob:expl-isog-2}
  Let $E$ and $E'$ be two elliptic curves, and $ℓ$ an integer. %
  Decide whether there exists an isogeny $ϕ:E→ E'$ of degree $ℓ$,
  and compute its kernel.
\end{problem}

The many variants of the explicit isogeny problem have kept the
research community busy for more than twenty years, and still do
today. %
Let's have a closer look at it. %

\subsection{Elkies' algorithm}

For a start, it should be noticed that both variants are by no means
``hard''. %
Indeed, we have explicit formulas for adding points on a curve $E$,
from which we can deduce an explicit formula for multiplying points on
$E$ by any scalar $ℓ∈ℤ$. %
Said otherwise, we have an explicit formula for the
multiplication-by-$ℓ$ isogeny, and, by reading its denominators, we
can deduce its kernel polynomial $h_ℓ$.\footnote{Up to a constant,
  $h_ℓ$ is the square of $ψ_ℓ$, the \emph{$ℓ$-th division polynomial}.
  See~\cite[III.4]{blake+seroussi+smart} for explicit formulas.} %

Let us assume for simplicity that $ℓ$ is prime and different from the
characteristic, then we know there are at most $ℓ+1$ normalized
isogenies of degree $ℓ$ from $E$. %
Factoring $h_ℓ$ over the field of definition $k$ of $E$ lets us
compute all possible kernel polynomials of order $ℓ$, and thus all
possible isogenies. %
At most $ℓ+1$ applications of Vélu's formula will then give the answer
to either of the two variants of the explicit isogeny problem. %
Since $E[ℓ]≃(ℤ/ℓℤ)^2$ over the algebraic closure, $h_ℓ$ has degree
$ℓ^2-1$, thus this algorithm costs no more than factoring a degree
$O(ℓ^2)$ polynomial in $k[x]$. %

We see that the matter is not solving the explicit isogeny
problem. The matter is solving it fast!

An interesting case, and the one Elkies was originally interested in,
is when the curves are defined over a finite field. %
Let us relax the problem a bit, and see what can be told about it. %
Decisional versions, first: two elliptic curves are said to be
\emph{isogenous} if there exists an isogeny connecting them (this is
an equivalence relation, thanks to the dual isogeny theorem).

\begin{problem}
  \label{prob:isogenous}
  Let $E,E'$ be two elliptic curves defined over a finite field
  $\F_q$, decide whether they are isogenous.
\end{problem}

Tate~\cite[Th.~1(c)]{Tate} famously showed\footnote{Tate, citing
  Mumford, also points out that, for the case of elliptic curves, this
  is an easy consequence of the much celebrated work of
  Deuring~\cite{deuring41}.} that $E$ and $E'$ are isogenous over
$\F_q$ if and only if $\#E(\F_q)=\#E'(\F_q)$. %
Schoof's point counting algorithm~\cite{schoof85,schoof95} completely
settles the problem by computing the orders of $E$ and $E'$ in
polynomial time in $\log(q)$. %
However, when we add a degree constraint, the problem immediately
becomes harder, even for finite fields. %

\begin{problem}
  \label{prob:ell-isogenous}
  Let $E,E'$ be two elliptic curves, and $ℓ$ be an integer. Decide
  whether they are $ℓ$-isogenous.
\end{problem}

The \emph{modular polynomial} helps solve this problem. %
Assuming $ℓ$ is prime, the $ℓ$-th modular polynomial, denoted by
$Φ_ℓ(x,y)$, it is a bivariate polynomial with coefficients in $ℤ$,
symmetric in $x$ and $y$, of degree $ℓ+1$ in each variable, with the
following property: two elliptic curves $E,E'$ are $ℓ$-isogenous if
and only if $Φ_ℓ(j(E),j(E'))=Φ_ℓ(j(E'),j(E))=0$. %
We stress that the definition of $Φ_ℓ$ is independent of the base
field. %
Given that $Φ_ℓ$ has $O(ℓ^2)$ coefficients (and rather large ones),
using it to decide the explicit isogeny problem is asymptotically only
slightly better than factoring the division polynomial; it is however
usually considerably more efficient in practice, especially when
tables of modular polynomials are precomputed, as is the case in
computer algebra systems such as Pari~\cite{Pari}, Magma~\cite{MAGMA},
or SageMath~\cite{Sage}. %

The modular polynomial can also be used to produce all isogenous
elliptic curves, up to isomorphism, to a given curve: simply plug
$j(E)$ in $Φ_ℓ$, then factor $Φ_ℓ(j(E),y)$ to find the isogenous
$j$-invariants. %
Elkies used this approach to reduce the explicit isogeny problem to
Problem~\ref{prob:expl-isog-2}, but he managed to extract even more
information from $Φ_ℓ$: he showed how to obtain a \emph{normalized
  equation} for the image curve.

\begin{theorem}[{\cite{elkies92,schoof95,elkies98}}]
  Let $E:y^2=x^3+ax+b$ be an elliptic curve, let $j$ be its
  $j$-invariant and let $j'$ be such that $Φ_ℓ(j,j')=0$. %
  Assume that $(∂Φ_ℓ/∂y)(j,j')≠0$, and define
  \begin{equation}
    \label{eq:elkies-modpol}
    \begin{aligned}
      λ &= \frac{-18}{ℓ}\frac{b}{a}\frac{\frac{∂Φ_ℓ}{∂x}(j,j')}{\frac{∂Φ_ℓ}{∂y}(j,j')}j,\\
      a' &= -\frac{1}{48}\frac{λ^2}{j'(j'-1728)}\frac{1}{ℓ^4},\\
      b' &= -\frac{1}{864}\frac{λ^3}{(j')^2(j'-1728)}\frac{1}{ℓ^6}.
    \end{aligned}
  \end{equation}
  Then there is a normalized isogeny of degree $ℓ$ from $E$ to
  $E':y^2=x^3+a'x+b'$.
\end{theorem}

Elkies' theorem prompts us to define a weaker variant of the explicit
isogeny problem.

\begin{problem}[Inverse Vélu problem\footnote{The name is ours and
    not attested in the literature.}]
  Let $E,E'$ be elliptic curves such that there exists a normalized
  isogeny $ϕ:E→ E'$ of degree $ℓ$. %
  Compute the kernel of $ϕ$.
\end{problem}

Unsurprisingly, Elkies also gave the solution to this problem
in~\cite{elkies92,elkies98}. %
He observed that the rational fractions defining $ϕ$ are related by a
differential equation, involving only the coefficients of $E$ and
$E'$. %
Solving the differential equation gives the rational fractions, and
thus the kernel. %
This gives a method to solve the inverse Vélu problem in $O(ℓ^2)$
operations over the base field, or even $\tildO(ℓ)$ using computer
algebra techniques as suggested by Bostan, Morain, Salvy and
Schost~\cite{bostan+morain+salvy+schost08}. %

We have, essentially, sketched the computation involved in the
Schoof-Elkies-Atkin point counting algorithm~\cite{schoof95}, for
those that are called \emph{Elkies primes} (more on these later). %
However, the last part of Elkies' algorithm, the solution to the
inverse Vélu problem, only works when the characteristic is $0$ or
\emph{large enough}. %
While this is good enough for counting points of elliptic curves
defined over a prime field $\F_p$, it fails, for example, over binary
fields. %

\subsection{Couveignes' algorithm}

After Elkies, others set out to solve the explicit isogeny problem in
small characteristic. %
While Elkies' method is grounded in complex analysis, and thus
naturally works in characteristic $0$,
Couveignes~\cite{couveignes94,couveignes96} and
Lercier~\cite{lercier96} introduced ``more algebraic'' methods, that
only work over finite fields. %

The one that shall interest us here is Couveignes' second method: a
strikingly simple idea to solve Problem~\ref{prob:expl-isog-2}
directly. %
It is based on the observation that any isogeny $ϕ:E→ E'$ must
preserve Sylow subgroups:
\begin{equation}
  ϕ(E[r^k]) \subseteq E'[r^k] \quad\text{for any prime $r$ and $k≥0$},
\end{equation}
with equality if $r$ does not divide $\deg ϕ$. %
If $E/\F_{p^n}$ is an ordinary curve, $E[p^k]≃ℤ/p^kℤ$ has a
particularly simple structure. %
The idea is to compute $E[p^k]$ and $E'[p^k]$ for $k$ large enough
(precisely, $p^k\sim 4\deg ϕ$), make a guess for the exact image of
one group into the other, and \emph{interpolate} the isogeny. %
If the guess was right, the computed isogeny can be verified through
Vélu's formulas; if not a new guess is made. %
Given that the $p^k$-torsion groups are cyclic, at most $φ(p^k)$
different guess must be made. %

Despite its simplicity, Couveignes' algorithm requires some heavy
computer algebra artillery to achieve a decent complexity, but with
some effort it can be made to run in $\tildO(ℓ^2p^3)$
operations~\cite{couveignes00,df+schost09,df10}. %
However, the polynomial dependency in $p$ is a serious handicap,
quickly making the algorithm unusable as the characteristic grows. %
Couveignes' other algorithm is affected by the same problem, whereas
Lercier's algorithm only works when $p=2$.

With the introduction of $p$-adic alternatives to Schoof's point
counting
algorithm~\cite{satoh00,kedlaya01,kedlaya04,lauder04,10.2307/24522768},
interest in solutions to the explicit isogeny problem limited to such
small characteristic started to fade. %
Later, Lercier and Sirvent~\cite{lercier+sirvent08} explained how to
extend Elkies' algorithm to finite fields of any characteristic, by
lifting the explicit isogeny problem to a $p$-adic field. %
Their algorithm only has a logarithmic dependency in the
characteristic, and gracefully degrades to Elkies' algorithm when $p$
becomes large enough. %
Said otherwise, Lercier and Sirvent effectively rendered all previous
algorithms obsolete! %

Incidentally, this coincides with the beginning of my career in
research, one that started off by desperately trying to beat the
cycles out of an algorithm that would be obsoleted before the end of
my first year as a PhD.\footnote{I can only imagine FM's cold sweats
  when Lercier and Sirvent published their algorithm. I did not
  understand at the time. I do now.}

Nevertheless, Couveignes' algorithm is still a great source of
inspiration, with many ramifications that we shall explore in the rest
of this work. %
By the end of this chapter it will be clear that its algebraic nature,
deeply related to Tate's isogeny theorem, has more to offer than what
may appear at first glance. %


\section{The neighborhood}

From now on, $\F_q$ will be a finite field of characteristic $p$, and
all elliptic curves and isogenies will be defined over it, unless
stated otherwise. %

We want to explore the ``neighborhood'' of $E/\F_q$, i.e., given a
prime $ℓ$, how many $ℓ$-isogenous curves to $E$ are there? What
properties do they have?

Fortunately, we have a Swiss-army-knife to answer these questions. %
The \emph{Frobenius endomorphism} is the map
\begin{equation*}
  \begin{aligned}
    π : E &→ E,\\
    (x,y) &↦ (x^q,y^q).
  \end{aligned}
\end{equation*}
Hasse's well known theorem states that $π$, as an element of the
endomorphism ring $\End(E)$, satisfies a quadratic equation with
integer coefficients $π^2 + q = tπ$, where $t$ is called the
\emph{trace} of $π$. %
Hasse also proved that $Δ_π=t^2-4q≤0$, with equality happening only if
$E$ is supersingular. %
$Δ_π$ is called the \emph{discriminant of $π$}. %

An isogeny $ϕ:E→E/G$ is $\F_q$-rational if and only if $π(G)=G$, which
suggests looking at the restriction of $π$ to $E[ℓ]$. %
Assume $ℓ≠p$, then $E[ℓ]$ is a group of rank $2$ and $π$ acts on it
like an element of $\GL_2(\F_ℓ)$, up to conjugation. %
Clearly, the order of $π$ in $\GL_2(\F_ℓ)$ is the degree of the
smallest extension of $\F_q$ where all $ℓ$-isogenies of $E$ are
defined. %
But we can tell even more by diagonalizing the matrix: $π$ must have
between $0$ and $2$ eigenvalues, and the corresponding eigenvectors
define kernels of rational isogenies. %
We thus are in one of the following four cases\footnote{In the point
  counting literature, Case~(0) is known as the \emph{Atkin case}, and
  Case~(2) as the \emph{Elkies case}}:
\begin{itemize}
\item[(0)] $π$ is not diagonalizable in $\F_ℓ$, then $E$ has no
  $ℓ$-isogenies.
\item[(1.1)] $π$ has one eigenvalue of (geometric) multiplicity one,
  i.e., it is conjugate to a non-diagonal matrix
  $\mat{λ&*\\0&λ}$; then
  $E$ has one $ℓ$-isogeny.
\item[(1.2)] $π$ has one eigenvalue of multiplicity two, i.e., it acts
  like a scalar matrix
  $\mat{λ&0\\0&λ}$; then
  $E$ has $ℓ+1$ isogenies of degree $ℓ$.
\item[(2)] $π$ has two distinct eigenvalues, i.e., it is conjugate to
  a diagonal matrix
  $\mat{λ&0\\0&μ}$ with
  $\lambda\neq\mu$; then $E$ has two $\ell$-isogenies.
\end{itemize}

Naturally, the number of eigenvalues of $π$ depends on the
factorization of the polynomial $x^2-tx+q$ over $\F_ℓ$, or
equivalently on the Kronecker symbol $\leg{Δ_π}{ℓ}$; the correspondence
is summarized in Table~\ref{tab:periodic-table}. %

Each of the four cases also corresponds to a different factorization
pattern of the modular polynomial. %
The following proposition is at the heart of Atkin's improvement to
Schoof's point counting algorithm. %

\begin{proposition}[Atkin~\cite{atkin91,atkin92}]
  Let $E/\F_q$ be a curve with $j(E)≠0,1728$. %
  Let $ℓ$ be a prime different from the characteristic, and let $Φ_ℓ$
  be the $ℓ$-th modular polynomial. %
  The number of distinct $\F_q$-rational normalized $ℓ$-isogenies of
  $E$ is equal to the number of linear factors of $Φ_ℓ(j(E),y)$ over
  $\F_q$; furthermore, the factorization degree pattern of
  $Φ_ℓ(j(E),y)$ falls into one of these four categories:
  \begin{itemize}
  \item[(0)] $r,\dots,r$ for some $r$ dividing $ℓ+1$;
  \item[(1.1)] $1,ℓ$;
  \item[(1.2)] $1,\cdots,1$;
  \item[(2)] $1,1,r,\cdots,r$ for some $r$ dividing $ℓ-1$.
  \end{itemize}
\end{proposition}

For ordinary elliptic curves, Kohel~\cite{kohel} showed that this
classification can be further refined by introducing a notion of
``depth'' of an elliptic curve. %
Let $K=ℚ[π]$ be an imaginary quadratic number field where we identify
the Frobenius $π$ to one root of $x^2-tx+q$. %
Let $\O_K$ be the ring of integers of $K$ then $\End(E)$ is isomorphic
to an order $\O$
\[ℤ[π] ⊂ \O ⊂ \O_K.\] %
We have already seen that two elliptic curves are isogenous over
$\F_q$ if and only if they have the same number of points;
equivalently, they are isogenous if and only if $ℚ[π_E]≃ℚ[π_{E'}]$. %
Kohel refined Tate's theorem as follows.

\begin{proposition}[{Kohel~\cite[Prop.~21]{kohel}}]
  Let $E,E'$ be elliptic curves defined over a finite field, and let
  $\O,\O'$ be their respective endomorphism ring. %
  Suppose that there exists an isogeny $ϕ:E→E'$ of prime degree $ℓ$,
  then $\O$ contains $\O'$ or $\O'$ contains $\O$, and the index of
  one in the other divides $ℓ$.
\end{proposition}

For a fixed prime $ℓ$, Kohel defines a curve $E$ to be \emph{at the
  surface} if $v_ℓ([\O_K:\End(E)])=0$, where $v_ℓ$ is the $ℓ$-adic
valuation. %
$E$ is said to be \emph{at depth $d$} if $v_ℓ([\O_K:\End(E)])=d$; the
maximal depth being $d_{\max}=v_ℓ([\O_K:ℤ[π]])$, curves at depth
$d_{\max}$ are said to be \emph{at the floor (of rationality)}, and
$d_{\max}$ is called the \emph{height} of the graph of $E$. %
Kohel calls then an $ℓ$-isogeny \emph{horizontal} if it goes to a
curve at the same depth, \emph{descending} if it goes to a curve at
greater depth, \emph{ascending} if it goes to a curve at lesser
depth. %

But how many horizontal and vertical $ℓ$-isogenies does a given curve
have? %
Typically this question is answered by the theory of complex
multiplication, but we shall use another strategy that better serves
our purpose. %
So far, the Frobenius endomorphism has only given us a ``local'' view
on the neighboring curves. %
We need to ``elevate'' our point of view and look further away, in
order to gain a global view on the whole isogeny class. %


\section{How isogeny graphs fold}

An \emph{isogeny graph} is a connected graph whose vertices are
elliptic curves up to isomorphism, and whose edges are isogenies under
some restrictions. %
In this chapter we are only interested in graphs of $ℓ$-isogenies, for
some fixed prime $ℓ$; other types of isogeny graphs will appear in
Chapter~\ref{cha:crypto}. %
Because of the dual isogeny theorem, these isogeny graphs are
undirected; technically we should be more properly speaking of
directed multi-graphs, since multiple edges and self-loops are
possible, but these cases are rare enough that we can deal with them
explicitly. %

As a first example, let us start with elliptic curves over the complex
numbers. %
We know every such curve has exactly $ℓ+1$ isogenies, thus the isogeny
graph is $ℓ+1$ regular. %
If we let $E/ℂ$ be a curve \emph{without complex multiplication},
i.e., such that $\End(E)=ℤ$, then its connected component cannot have
loops, otherwise that would provide a non-trivial endomorphism of
$E$. %
Hence, the isogeny graph of $E$ is an infinite $(ℓ+1)$-tree, as
pictured in Figure~\ref{fig:infinite-tree}. %
Despite the nice drawing, this graph is, algebraically, ``boring'': it
looks the same from every vertex, there is not much we can say on it
that is not already contained in the statement ``infinite tree'';
contrary to what the drawing suggests, this graph has no ``origin''.

\begin{figure}
  \centering
    \begin{tikzpicture}[scale=0.6]
      \def\levels{6}
      \draw[fill] (0:0) circle (2pt);
      \foreach \i in {1,...,\levels} {
        \pgfmathparse{3*2^\i}
        \let\nodes\pgfmathresult
        \foreach \j in {1,3,...,\nodes} {
          \pgfmathparse{\j + (-1)^div(\j,2)}
          \let\lower\pgfmathresult
          \ifthenelse{\i = \levels}{
            \draw[dotted] (360/\nodes*\j : \i) --
            (360/\nodes*\lower : \i - 1);
          }{
            \draw[fill] (360/\nodes*\j : \i) circle (2pt) --
            (360/\nodes*\lower : \i - 1);
          }
        }
      }
    \end{tikzpicture}
  
    \caption{Infinite $2$-isogeny graph of elliptic curves without
      complex multiplication.}
  \label{fig:infinite-tree}
\end{figure}

Going back to finite fields, the picture gets more interesting. %
For one, there is only a finite number of elliptic curves, so these
graphs are finite. %
Extending scalars to the algebraic closure adds vertices to these
graphs, and makes them $ℓ+1$ regular; but how are these regular graphs
going to ``fold'' inside the finite subfields of $\bar{\F}_q$? %

For the case of supersingular curves, we know that there is only a
finite number of them, up to isomorphism; so supersingular isogeny
graphs are $(ℓ+1)$-regular and finite! %
We will say more on them in Chapter~\ref{cha:crypto}. %

For the case of ordinary curves, we have already discussed the notion
of ``depth'', we thus know that, as we travel along a path of
descending isogenies, there is an algebraic invariant that tells us
how far we are from the surface. %
Said otherwise, unlike the graph of $E/ℂ$ without complex
multiplication, that of $E/\F_q$ has one, or more, ``origins''. %

What about horizontal isogenies? %
Can we construct indefinitely long walks entirely made of them? %
Here is a spoiler: no! %
The theory of complex multiplication tells us that there is only a
finite number of elliptic curves defined over $\bar{\F}_q$, up to
isomorphism, with endomorphism ring isomorphic to a given order. %
But let's pretend we do not know complex multiplication, and slowly
work our way towards classifying horizontal isogenies. %

Here is an intuition. %
In the same way the action of $π$ on $E[ℓ]$ allowed us to ``see'' the
neighbors of $E$ in the $ℓ$-isogeny graph, ``climbing'' to $π|E[ℓ^n]$
will give us a view on the ball of radius $n$ around $E$. %
If we ``elevate'' our point of view ``high enough'', we shall be able
to see enough of the graph to understand how it ``folds'' inside
$\F_q$. %
As long as we are not doing computations, the simplest way to go high
enough is to go ``infinitely high'', i.e., study the restriction of
$π$ to the \emph{Tate module} $T_ℓ(E)$. %

The \emph{Tate module} $T_ℓ(E)$ is the \emph{projective limit}
\begin{equation*}
  T_ℓ(E) = \varprojlim E[ℓ^n]
\end{equation*}
given by the natural projections
\begin{equation*}
  E[ℓ^n]\overset{[ℓ]}{→}E[ℓ^{n-1}].  
\end{equation*}
Since the $E[ℓ^n]$ are $ℤ/ℓ^nℤ$-modules, $T_ℓ(E)$ has a $ℤ_ℓ$-module
structure, where $ℤ_ℓ$ denotes the $ℓ$-adic integers. %
Tate's isogeny theorem states that, for finite fields, studying
morphisms of $T_ℓ(E)$ is the same as studying isogenies of $E$.

\begin{theorem}[{Tate~\cite{Tate}}]
  Let $\F_q$ be a finite field of characteristic $p$, and let $ℓ≠p$ be
  a prime. %
  Let $E,E'$ be elliptic curves defined over $\F_q$, the canonical
  map %
  \begin{equation*}
    \Hom_{\F_q}(E,E')⊗ℤ_ℓ → \Hom_{\F_q}(T_ℓ(E),T_ℓ(E'))
  \end{equation*}
  is an isomorphism of $ℤ_ℓ$-modules.
\end{theorem}

Tate's theorem has many important consequences. %
Among those, we have already mentioned that $E$ and $E'$ are isogenous
if and only if $\#E(\F_q)=\#E'(\F_q)$. %
Furthermore, the action of $π$ on $T_ℓ(E)$ provides a $2$-dimensional
representation of $\Gal(\bar{\F}_q/\F_q)$, and Tate's theorem states
that $E$ and $E'$ are isogenous over $\F_q$ if and only if $T_ℓ(E)$
and $T_ℓ(E')$ are isomorphic as $ℚ_ℓ$-representations. %
Explicitly computing this representation gives us another mean of, in
Kohel's words, ``probing the depth''. %

\begin{proposition}[{D., Hugounenq, Plût~\cite{defeo2016explicit}}]
  \label{th:tate-matrix-elkies}
  Let~$E/\F_q$ be an ordinary elliptic curve with Frobenius
  endomorphism~$π$. %
  Assume that the characteristic polynomial of~$π$ has two distinct
  roots~$λ, μ$ in~$ℤ_ℓ$, and let $h=v_ℓ(λ-μ)$. %
  Then there exists a unique $e ∈ \{0,h\}$ such that $π|T_ℓ(E)$~is
  conjugate, over~$ℤ_ℓ$, to the matrix $\mat{λ&ℓ^e\\0&μ}$. %
  
  Moreover, $h=v_ℓ([\End(E):ℤ[π]])$ is the height of the graph of $E$:
  if~$E$ lies at the surface, $e = h$ and $π|T_ℓ(E)$ is also conjugate
  over~$ℤ_ℓ$ to $\mat{λ&0\\0&μ}$; otherwise $h - e$~is the depth
  of~$E$.
\end{proposition}

\begin{proposition}
  \label{th:tate-matrix-atkin}
  TODO: similar statement for Atkin and ramified primes. Conjecture:
  about the same, but only true modulo $ℓ^h$.
\end{proposition}

Note that the number of roots of the characteristic polynomial of $π$
in $ℤ_ℓ$ is effectively computed as $1+\leg{Δ_K}{ℓ}$, where $Δ_K$ is
the \emph{fundamental discriminant} of the polynomial. %

We thus have an effective \emph{bathymeter} to navigate the isogeny
graph: it is indeed sufficient to compute $π|T_ℓ(E)$ up to precision
$ℓ^h$, i.e., $π|E[ℓ^h]$, in order to determine the depth of $E$. %
This generalizes previous partial results of Miret et
al.~\cite{MiretMSTV06,MIRET200867} and Ionica and
Joux~\cite{ionica+joux13}. %

But the propositions also give us an effective way to characterize
horizontal isogenies. %
Indeed, if $ϕ:E→E'$ is an $\F_q$-rational $ℓ$-isogeny, $ϕ_ℓ$ its
restriction to $T_ℓ(E)$, and we let $π,π'$ be the Frobenius
endomorphisms of $E,E'$, then $π' = ϕ_ℓπϕ_ℓ^{-1}$ (where we have
tensored by $ℚ_ℓ$ to make sense of $ϕ_ℓ^{-1}$). %
% TODO: experiments give me π' = ϕ^-1 π ϕ
Up to change of basis of $T_ℓ(E')$, the $ℓ+1$ isogenies of degree $ℓ$
are represented by the matrices $\mat{1&0\\0&ℓ}$ and $\mat{ℓ&a\\0&1}$
for $0≤a<ℓ$; if we have an explicit $\GL_2(ℤ_ℓ)$ representation for
$π|T_ℓ(E)$, we can compute the representations of $π'|T_ℓ(E')$ for
each of these isogenies, and use
Propositions~\ref{th:tate-matrix-elkies}
and~\ref{th:tate-matrix-atkin} to recognize those that are
horizontal. %

We can go even further and look at $ℓ^n$-isogenies, represented by
multiplying the elementary matrices of the $ℓ$-isogenies, and
quotienting out scalar multiplications. %
We obtain the tree structure\footnote{Serre~\cite[II]{SL2} calls this
  the tree of $\SL_2$ over $ℤ_ℓ$. %
  I am grateful to J. Plût for explaining this to me, and providing
  the Ti\emph{k}Z code for Figure~\ref{fig:serre-tree}} %
on $\PGL_2(ℚ_ℓ)/\PGL_2(ℤ_ℓ)$ shown in Figure~\ref{fig:serre-tree},
where matrices at distance $n$ from $\mat{1&0\\0&1}$ represent
isogenies of degree $ℓ^n$. %
A path in the tree corresponds to a path in the isogeny graph;
conjugating $π$ by the corresponding node we obtain the Frobenius
matrix of the end curve, and we may thus identify paths that
correspond to, e.g., horizontal walks. %

\begin{figure}
  \centering
  \begin{tikzpicture}[grow cyclic,level distance=8ex]
    \tikzstyle{level 1}=[sibling angle=120]
    \tikzstyle{level 2}=[sibling angle=90]
    \tikzstyle{level 3}=[sibling angle=70]
    \node{$\mat{1&0\\0&1}$}
    child{ node{$\mat{2&0\\0&1}$}
      child { node {$\mat{4&0\\0&1}$}
        child { node {$\mat{8&0\\0&1}$} }
        child { node {$\mat{8&4\\0&1}$} }
      }
      child { node {$\mat{4&2\\0&1}$}
        child { node {$\mat{8&2\\0&1}$} }
        child { node {$\mat{8&6\\0&1}$} }
      }
    }
    child{ node{$\mat{2&1\\0&1}$}
      child { node {$\mat{4&1\\0&1}$}
        child { node {$\mat{8&1\\0&1}$} }
        child { node {$\mat{8&5\\0&1}$} }
      }
      child { node {$\mat{4&3\\0&1}$}
        child { node {$\mat{8&3\\0&1}$} }
        child { node {$\mat{8&7\\0&1}$} }
      }
    }
    child{ node{$\mat{1&0\\0&2}$}
      child { node {$\mat{2&1\\0&2}$}
        child { node {$\mat{4&3\\0&2}$} }
        child { node {$\mat{4&1\\0&2}$} }
      }
      child { node {$\mat{1&0\\0&4}$}
        child { node {$\mat{2&1\\0&4}$} }
        child { node {$\mat{1&0\\0&8}$} }
      }
    }
    ;
  \end{tikzpicture}
  \caption{$ℓ$-adic Serre tree, representing isogenies of degree $ℓ^n$
    on $T_ℓ(E)$.}
  \label{fig:serre-tree}
\end{figure}

For example, assume that the characteristic polynomial of $π$ has two
distinct roots, so that we are in the setting of
Proposition~\ref{th:tate-matrix-elkies}. %
If $π$ diagonalizes as $\mat{λ&0\\0&μ}$, the two isogenies
$\mat{1&0\\0&ℓ}$ and $\mat{ℓ&0\\0&1}$ do not change the matrix of $π$,
thus they are both horizontal, whereas all other isogenies are
descending. %
On the other hand, if $π$ can only be put in the form
$\mat{λ&ℓ^e\\0&μ}$, we see that the isogeny $\mat{1&0\\0&ℓ}$ is
ascending, whereas all others are descending. %
Finally, if $π$ is of the form $\mat{λ&1\\0&μ}$, then we have one
ascending isogeny as before, however no descending isogeny is
rational. %

By applying the same methods to $\leg{Δ_K}{ℓ}=-1,0$, we can prove a
complete classification of rational isogenies. %
This is summarized in Table~\ref{tab:periodic-table}. %

\begin{theorem}[{Kohel~\cite{kohel}}]
  \label{prop:isogeny-count}
  Let~$E/\F_q$ be an ordinary elliptic curve, $π$ its Frobenius
  endomorphism, and $Δ_K$ the fundamental discriminant of $ℚ[π]$. %
  \begin{enumerate}
  \item If $E$ is not at the floor, there are $ℓ+1$ isogenies of
    degree $ℓ$ from~$E$, in total.
  \item If $E$ is at the floor, there are no descending $ℓ$-isogenies
    from~$E$.
  \item If $E$ is at the surface, then there are
    $\left(\frac{Δ_K}{ℓ}\right)+1$~horizontal $ℓ$-isogenies from~$E$
    (and no ascending $ℓ$-isogenies).
  \item If $E$ is not at the surface, there are no horizontal
    $ℓ$-isogenies from~$E$, and one ascending $ℓ$-isogeny.
  \end{enumerate}
\end{theorem}

\begin{table}
  \centering
  \def\arraystretch{1.3}
  \begin{tabular}{c | c | c | c c c}
    \multicolumn{3}{c|}{} & \multicolumn{3}{c}{Isogeny types}\\
    \multicolumn{3}{c|}{} & $→$ & $↑$ & $↓$\\
    \hline
    $\leg{Δ_π}{ℓ}≠0$ & $ℓ\nmid[\O_K:\O]]$ & $ℓ\nmid[\O:ℤ[π]]$ & $1+\leg{Δ_K}{ℓ}$& &\\
    \hline
    & $ℓ\nmid[\O_K:\O]]$ & $ℓ\mid[\O:ℤ[π]]$ &$1+\leg{Δ_K}{ℓ}$& &$ℓ-\leg{Δ_K}{ℓ}$\\
    $\leg{Δ_π}{ℓ}=0$ & $ℓ\mid[\O_K:\O]]$ & $ℓ\mid[\O:ℤ[π]]$ &  &$1$&$ℓ$\\
    & $ℓ\mid[\O_K:\O]]$ & $ℓ\nmid[\O:ℤ[π]]$ & &$1$& 
  \end{tabular}
  \caption{Number and types of $ℓ$-isogenies, according to splitting
    type of the characteristic polynomial of $π$.}
  \label{tab:periodic-table}
\end{table}

This theorem shows that, away from the surface, isogeny graphs just
look like $ℓ$-regular complete trees of bounded height, with $ℓ$
descending isogenies at every level except the floor. %
However, the surface has a more varied structure:
\begin{itemize}
\item[(0)] If $\leg{Δ_K}{ℓ}=-1$, there are no horizontal isogenies: the
  isogeny graph is just a complete tree of degree $ℓ+1$ at the surface
  and degree $ℓ$ at all other levels. %
  We call this the \emph{Atkin case}, as it is an extension of the
  Atkin case in the SEA point counting algorithm.
\item[(1)] If $\leg{Δ_K}{ℓ}=0$, there is exactly one horizontal
  isogeny $ϕ:E→E'$ at the surface. %
  Since $E'$ also has one horizontal isogeny, it necessarily is
  $\hat{ϕ}$, so the surface only contains two elliptic curves, each
  the root of an $ℓ$-regular complete tree. %
  We call this the \emph{ramified case}.
\item[(2)] The case $\leg{Δ_K}{ℓ}=1$, is arguably the most interesting
  one. %
  Each curve at the surface has exactly two horizontal isogenies, thus
  the subgraph made by curves on the surface is two-regular and
  finite, i.e., a cycle. %
  The eigenvalue $λ$ (resp. $μ$) of $π$ defines an eigenspace, that
  projects onto a cyclic subgroup of $E[ℓ^n]$, which is the kernel of
  an $ℓ^n$-isogeny represented by the matrix $\mat{ℓ^n&0\\0&1}$
  (resp. $\mat{1&0\\0&ℓ^n}$). %
  Hence, $λ$ and $μ$ define two opposite directions on the cycle,
  independent of the starting point, and dual to one another. %

  Below each curve of the surface there are $ℓ-1$ curves, each the
  root of an $ℓ$-regular tree. %
  We call this the \emph{Elkies case}, again by extension of point
  counting. %
\end{itemize}

\begin{figure}[h]
  \centering
  \begin{tikzpicture}
    \begin{scope}
      \draw[fill] (0,0) circle (2pt)
      -- (-1,-1) circle (2pt)
      (0,0) -- (0,-1) circle (2pt)
      (0,0) -- (1,-1) circle (2pt);
      \node at (0,-2) {Atkin: $\left(\frac{Δ_K}{ℓ}\right) = -1$};
    \end{scope}    

    \begin{scope}[xshift=3.5cm]
      \draw[fill] (0,0) circle (2pt)
      -- (-0.5,-1) circle (2pt)
      (0,0) -- (0.5,-1) circle (2pt)
      (0,0) -- (2,0) circle (2pt)
      -- (1.5,-1) circle (2pt)
      (2,0) -- (2.5,-1) circle (2pt);
      \node at (1,-2) {ramified: $\left(\frac{Δ_K}{ℓ}\right) = 0$};
    \end{scope}
    
    \begin{scope}[xshift=9cm]
      \draw[fill] (-0.8,0) node[coordinate] (A) {} circle (2pt)
      -- +(0,-1) circle (2pt)
      (0,-0.3) node[coordinate] (B) {} circle (2pt)
      -- +(0,-1) circle (2pt)
      (0.8,0) node[coordinate] (C) {} circle (2pt)
      -- +(0,-1) circle (2pt);
      \draw[bend right=20]
      (A) edge (B)
      (B) edge (C)
      (C) edge[dashed,bend right=90] (A);
      \node at (0,-2) {Elkies: $\left(\frac{Δ_K}{ℓ}\right) = +1$};
    \end{scope}
  \end{tikzpicture}
  \caption{The three shapes of volcanoes of $2$-isogenies }
  \label{fig:volcanology}
\end{figure}

The three cases are summarized in Figure~\ref{fig:volcanology}. %
The shapes of the graphs, in particular the Elkies case, suggest a
geological metaphor: Fouquet and Morain~\cite{fouquet+morain02}
famously called them \emph{isogeny volcanoes}. %
Adhering to this metaphor, from now on we shall call \emph{crater} the
cycle at the surface of an Elkies volcano, but we shall refrain from
using this name for the surface of other types of volcanoes.%
\footnote{The literature, including my own
  works~\cite{defeo2016explicit}, is inconsistent on the use of the
  word ``crater'' for non-Elkies volcanoes.} %
Of course, to reconcile Kohel's metaphors with Fouquet and Morain's,
we shall assume isogeny volcanoes are underwater, with the crater just
touching the sea surface.



\section{Explicit isogenies in quadratic time}

\section{Perspectives}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Panoptycon}
\label{cha:fpbar}

- towers of finite fields,
- isomorphisms, embeddings,
- Fp-bar
- lattices

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Crypto and quantum computers}
\label{cha:crypto}

- Expander graphs
- HHS, CSIDH
- SIDH
- Signatures?
- Quantum algorithms? Kuperberg?

- use our couveignes to break CSIDH

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\clearpage
\bibliographystyle{plain}
\bibliography{hdr}

\end{document}

% LocalWords:  isogeny isogenies morphism surjective projective Hasse
% LocalWords:  preimage bijection cryptosystems univariate Decisional
% LocalWords:  isomorphisms isogenous Schoof's decisional bivariate
% LocalWords:  precomputed  Abelian Vélu's Elkies Couveignes Lercier
% LocalWords:  Schoof endomorphism Frobenius supersingular Kohel
% LocalWords:  diagonalizing diagonalizable diagonalization morphisms
% LocalWords:  undirected bathymeter endomorphisms tensored subgraph
% LocalWords:  quotienting eigenspace
